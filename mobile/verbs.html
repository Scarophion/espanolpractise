<!DOCTYPE html>
<html>
	<head>
		<title>Verbs</title>
		<script>const data = 
			{
				"verbs": [
					{
						"name": "ser",
						"translation": "to be (permanent things)",
						"conjugation":[
							{
								"tense": "pretérito",
								"form": ["fui", "fuiste", "fue", "fuimos", "fuistes", "fueron"]
							},
							{
								"tense": "presente",
								"form": ["soy", "eres", "es", "somos", "sois", "son"]
							},
							{
								"tense": "futuro",
								"form": ["seré", "serás", "será", "seremos", "seréis", "serán"]
							}
						]
					},
					{
						"name": "estar",
						"translation": "to be (impermanent things)",
						"conjugation":[
							{
								"tense": "pretérito",
								"form": ["estuve", "estuviste", "estuvo", "estuvimos", "estuvisteis", "estuvieron"]
							},
							{
								"tense": "presente",
								"form": ["estoy", "estás", "está", "estamos", "estáis", "estan"]
							},
							{
								"tense": "futuro",
								"form": ["estaré", "estarás", "estará", "estaremos", "estaréis", "estarán"]
							}
						]
					},		
					{
						"name": "hablar",
						"translation": "to speak",
						"conjugation":[
							{
								"tense": "pretérito",
								"form": ["hablé", "hablaste", "habló", "hablamos", "hablasteis", "hableron"]
							},
							{
								"tense": "presente",
								"form": ["hablo", "hablas", "habla", "hablamos", "habláis", "hablan"]
							},
							{
								"tense": "futuro",
								"form": ["hablaré", "hablarás", "hablara", "hablaremos", "hablaréis", "hablarán"]
							}
						]
					},		
					{
						"name": "comer",
						"translation": "to eat",
						"conjugation":[
							{
								"tense": "pretérito",
								"form": ["comí", "comiste", "comió", "comimos", "comisteis", "comimeron"]
							},
							{
								"tense": "presente",
								"form": ["como", "comes", "come", "comemose", "coméis", "comen"]
							},
							{
								"tense": "futuro",
								"form": ["comeré", "comerás", "comerá", "comeremos", "comeréis", "comeran"]
							}
						]
					},		
					{
						"name": "vivir",
						"translation": "to live",
						"conjugation":[
							{
								"tense": "pretérito",
								"form": ["viví", "viviste", "vivió", "vivimos", "vivisteis", "vivieron"]
							},
							{
								"tense": "presente",
								"form": ["vivo", "vives", "vives", "vivimos", "vivis", "viven"]
							},
							{
								"tense": "futuro",
								"form": ["viviré", "vivirás", "vivirá", "viviremos", "viviréis", "vivirán"]
							}
						]
					}
				]
			}
			
			var currentTxtBoxId = undefined;

			function initialise(){
				createButtons();
				createTable(data.verbs[0]);
			};

			function createButtons(){
				var radioDiv = document.getElementById("verbSelect");
				data.verbs.forEach((verb, index) =>{
					var checked = "";
					if (verb == data.verbs[0]){
						checked = "checked";
					}
					var radio = '<input type="radio" name="verb" value="'+verb.name+'" '+checked+' onClick="changeVerb('+index+');" /><span>'+verb.name+'</span>';
					radioDiv.innerHTML += radio;
				});
			};

			function createTable(verb){
				var source = document.getElementById("verbTableTemplate").innerHTML;
				source = source.replace("{{verbName}}", verb.name);
				source = source.replace("{{verbDesc}}", verb.translation);
				
				var tenses = "";
				var yoConj = "";
				var tuConj = "";
				var elConj = "";
				var nosConj = "";
				var vosConj = "";
				var ellosConj = "";
				
				verb.conjugation.forEach((tense, index) =>{
					tenses += '<th>'+tense.tense+'</th>';
					yoConj += '<td><input id="conj'+index+'_'+0+'" type=text" data-answer="'+tense.form[0]+'" onfocus="currentTextBox(\'conj'+index+'_'+0+'\');" /><span class="hidden">'+tense.form[0]+'</span></td>';
					tuConj += '<td><input id="conj'+index+'_'+1+'" type=text" data-answer="'+tense.form[1]+'" onfocus="currentTextBox(\'conj'+index+'_'+1+'\');" /><span class="hidden">'+tense.form[1]+'</span></td>';
					elConj += '<td><input id="conj'+index+'_'+2+'" type=text" data-answer="'+tense.form[2]+'" onfocus="currentTextBox(\'conj'+index+'_'+2+'\');" /><span class="hidden">'+tense.form[2]+'</span></td>';
					nosConj += '<td><input id="conj'+index+'_'+3+'" type=text" data-answer="'+tense.form[3]+'" onfocus="currentTextBox(\'conj'+index+'_'+3+'\');" /><span class="hidden">'+tense.form[3]+'</span></td>';
					vosConj += '<td><input id="conj'+index+'_'+4+'" type=text" data-answer="'+tense.form[4]+'" onfocus="currentTextBox(\'conj'+index+'_'+4+'\');" /><span class="hidden">'+tense.form[4]+'</span></td>';
					ellosConj += '<td><input id="conj'+index+'_'+5+'" type=text" data-answer="'+tense.form[5]+'" onfocus="currentTextBox(\'conj'+index+'_'+5+'\');" /><span class="hidden">'+tense.form[5]+'</span></td>';
				});
				
				source = source.replace("{{tenses}}", tenses);
				source = source.replace("{{yo-conj}}", yoConj);
				source = source.replace("{{tu-conj}}", tuConj);
				source = source.replace("{{el-conj}}", elConj);
				source = source.replace("{{nos-conj}}", nosConj);
				source = source.replace("{{vos-conj}}", vosConj);
				source = source.replace("{{ellos-conj}}", ellosConj);
				
				var workingArea = document.getElementById("workingArea");
				workingArea.innerHTML = source;
			}

			function changeVerb(index){
				createTable(data.verbs[index]);
				hideAnswersButton();
			}

			function check(){	
				var table = document.getElementById("verbTable");
				var answers = table.querySelectorAll("input");
				answers.forEach((answer) => {
					if (answer.value === ""){
						answer.parentElement.classList.remove("correct");
						answer.parentElement.classList.remove("wrong");			
					} else if (answer.value == answer.dataset.answer){
						answer.parentElement.classList.add("correct");
						answer.parentElement.classList.remove("wrong");
					} else{
						answer.parentElement.classList.remove("correct");
						answer.parentElement.classList.add("wrong");
					}
				});
			}

			function reveal(){
				check();
				var table = document.getElementById("verbTable");
				var answers = table.querySelectorAll("input");
				answers.forEach((answer) => {
					answer.classList.add("hidden");
					answer.parentElement.querySelector("span").classList.remove("hidden");
				});
				document.getElementById("butReveal").classList.add("hidden");
				document.getElementById("butHideAnswers").classList.remove("hidden");
			}

			function reset(){
				var table = document.getElementById("verbTable");
				var answers = table.querySelectorAll("input");
				answers.forEach((answer) => {
					answer.value = "";
					answer.classList.remove("hidden");
					answer.parentElement.classList.remove("correct");
					answer.parentElement.classList.remove("wrong");
					answer.parentElement.querySelector("span").classList.add("hidden");
				});
				hideAnswersButton();
			};

			function hideAnswers(){
				var table = document.getElementById("verbTable");
				var answers = table.querySelectorAll("input");
				answers.forEach((answer) => {
					answer.classList.remove("hidden");
					answer.parentElement.querySelector("span").classList.add("hidden");
				});
				hideAnswersButton();
			}

			function insert(character){console.log(currentTxtBoxId);
				var txtBox = document.getElementById(currentTxtBoxId);
				txtBox.value +=character;
				txtBox.focus();
			}

			function hideAnswersButton(){	
				document.getElementById("butReveal").classList.remove("hidden");
				document.getElementById("butHideAnswers").classList.add("hidden");
			}

			function currentTextBox(txtBoxId){console.log(txtBoxId);
				currentTxtBoxId = txtBoxId;
			}
</script>
		<style>
		#verbTable{
			width: 100%;
			border-collapse: collapse;
		}

		#verbTable th{
			text-align: left;
		}

		#verbTable td{
			border: 1px solid;
			padding: 1px;
		}

		#verbTable td.correct input,
		#verbTable td.correct span
		{
			color:green;
		}

		#verbTable td.wrong input,
		#verbTable td.wrong span{
			color:red;
		}

		#verbTable td.correct::after {
		  content: '✔️';
		}
		#verbTable td.wrong::after {
		  content: '❌';
		}

		.hidden{
			display:none;
		}
		</style>
	</head>
	<body>
		<h1>Verbs</h1>
		<div id="wrapper">
			<div id="controls">
				<div id="verbSelect">
				</div>
				<div>
					<input type="submit" value="Check" onClick="check();" />
					<input id="butReveal" type="submit" value="Reveal" onClick="reveal();" />
					<input id="butHideAnswers" type="submit" value="Hide Answers" onClick="hideAnswers();" class="hidden" />
					<input type="submit" value="Reset" onClick="reset();" />
				</div>
			</div>
			<div id="workingArea">
			</div>			
			<div>
				<input type="submit" value="á" onClick="insert('á');" />
				<input type="submit" value="é" onClick="insert('é');" />
				<input type="submit" value="í" onClick="insert('í');" />
				<input type="submit" value="ó" onClick="insert('ó');" />
				<input type="submit" value="ú" onClick="insert('ú');" />
				<input type="submit" value="ñ" onClick="insert('ñ');" />
			</div>
		</div>
		
		<script id="verbTableTemplate" type="text/x-handlebars-template">
			<div class="container">
				<h2>{{verbName}} - {{verbDesc}}</h2>
				<table id="verbTable">
					<thead>
						<tr>
							<th></th>
							{{tenses}}
						</tr>
					</thead>
					<tbody>
						<tr>
							<td>Yo</td>
							{{yo-conj}}
						</tr>
						<tr>
							<td>Tú</td>
							{{tu-conj}}
						</tr>
						<tr>
							<td>Él/Ella/Usted</td>
							{{el-conj}}
						</tr>
						<tr>
							<td>Nosotros</td>
							{{nos-conj}}
						</tr>
						<tr>
							<td>Vosotros</td>
							{{vos-conj}}
						</tr>
						<tr>
							<td>Ellos/Ellas</td>
							{{ellos-conj}}
						</tr>
					</tbody>
				</table>
			</div>
		</script>
		<script type="text/javascript">
			initialise();
		</script>
	</body>
</html>